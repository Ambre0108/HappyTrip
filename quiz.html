<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Quiz</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
    body {
        background: #f5f5f5;
        font-family: Arial, sans-serif;
        padding: 30px;
    }

    #quiz-container {
        max-width: 700px;
        margin: auto;
        padding: 30px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        text-align: center;
    }

    #status {
        font-size: 14px;
        color: #666;
        margin-bottom: 10px;
    }

    #question {
        font-size: 32px;
        font-weight: bold;
        margin-bottom: 20px;
        min-height: 56px;
    }

    .answer-btn {
        display: block;
        width: 100%;
        padding: 18px;
        margin: 12px 0;
        font-size: 22px;
        border: none;
        border-radius: 10px;
        background: #e0e0e0;
        cursor: pointer;
        transition: 0.25s;
    }

    .answer-btn:hover { background: #d2d2d2; }
    .correct { background: #4CAF50 !important; color: white; }
    .wrong   { background: #E53935 !important; color: white; }

    #next-btn {
        margin-top: 20px;
        padding: 12px 20px;
        font-size: 18px;
        border: none;
        background: #1976D2;
        color: white;
        border-radius: 10px;
        cursor: pointer;
        display: none;
    }

    #result { font-size: 26px; margin-top: 20px; font-weight: bold; }

    #error {
        color: #b00020;
        font-weight: bold;
        margin-bottom: 12px;
    }
</style>
</head>
<body>

<div id="quiz-container">
    <div id="status"></div>
    <div id="error" style="display:none;"></div>
    <div id="question"></div>
    <div id="choices"></div>
    <button id="next-btn">Question suivante</button>
    <div id="result"></div>
</div>

<!-- Charge la banque de questions en premier -->
<script src="questions.js" defer></script>

<!-- Script principal -->
<script defer>
/*
  Script principal du quiz
  Utilise Math.min(5, questionsBank.length) pour s'adapter
  Affiche messages clairs si questions.js absent ou vide
*/

function showError(message) {
    const errDiv = document.getElementById('error');
    errDiv.style.display = 'block';
    errDiv.textContent = message;
    console.error('Quiz error:', message);
}

function showStatus(text) {
    document.getElementById('status').textContent = text;
}

function getRandomQuestions(list, count) {
    const shuffled = [...list].sort(() => Math.random() - 0.5);
    return shuffled.slice(0, count);
}

document.addEventListener('DOMContentLoaded', () => {
    // Vérifications initiales
    if (typeof questionsBank === 'undefined') {
        showError("Erreur : le fichier questions.js n'a pas été trouvé ou n'a pas chargé. Vérifie le chemin et le nom du fichier.");
        showStatus("Aucune question disponible.");
        return;
    }

    if (!Array.isArray(questionsBank) || questionsBank.length === 0) {
        showError("La banque de questions est vide. Ajoute des questions dans questions.js.");
        showStatus("Aucune question disponible.");
        return;
    }

    // Détermine le nombre de questions (max 5 ou moins si banque petite)
    const TOTAL_QUESTIONS = Math.min(5, questionsBank.length);
    const quiz = getRandomQuestions(questionsBank, TOTAL_QUESTIONS);

    let currentQuestion = 0;
    let score = 0;

    const questionEl = document.getElementById('question');
    const choicesDiv = document.getElementById('choices');
    const nextBtn = document.getElementById('next-btn');
    const resultDiv = document.getElementById('result');

    function updateProgress() {
        showStatus(`Question ${currentQuestion + 1} / ${quiz.length}`);
    }

    function loadQuestion() {
        // reset error display
        document.getElementById('error').style.display = 'none';

        updateProgress();
        const q = quiz[currentQuestion];
        if (!q || !q.choices || typeof q.answer !== 'number') {
            showError("Question mal formée. Vérifie l'objet question dans questions.js.");
            return;
        }

        questionEl.textContent = q.question;
        choicesDiv.innerHTML = '';
        nextBtn.style.display = 'none';

        // créer boutons pour chaque choix
        q.choices.forEach((choice, index) => {
            const btn = document.createElement('button');
            btn.className = 'answer-btn';
            btn.textContent = choice;
            btn.type = 'button';
            btn.addEventListener('click', () => checkAnswer(index, btn));
            choicesDiv.appendChild(btn);
        });
    }

    function checkAnswer(selectedIndex, clickedButton) {
        const q = quiz[currentQuestion];
        const correctIndex = q.answer;
        const buttons = choicesDiv.querySelectorAll('.answer-btn');

        // désactiver tous
        buttons.forEach(b => b.disabled = true);

        if (selectedIndex === correctIndex) {
            clickedButton.classList.add('correct');
            score++;
        } else {
            clickedButton.classList.add('wrong');
            // montrer la bonne réponse (si existe)
            if (buttons[correctIndex]) {
                buttons[correctIndex].classList.add('correct');
            }
        }

        nextBtn.style.display = 'inline-block';
        nextBtn.focus();
    }

    nextBtn.addEventListener('click', () => {
        currentQuestion++;
        if (currentQuestion < quiz.length) {
            loadQuestion();
        } else {
            // fin du quiz
            questionEl.textContent = 'Quiz terminé !';
            choicesDiv.innerHTML = '';
            nextBtn.style.display = 'none';
            resultDiv.innerHTML = `Score : <strong>${score}</strong> / ${quiz.length}`;
            showStatus('Terminé');
            // optionnel : détailler résultats, proposer rejouer...
        }
    });

    // Lancement initial
    console.log(`Quiz chargé — questions en banque: ${questionsBank.length}. Quiz length: ${quiz.length}`);
    loadQuestion();
});
</script>

</body>
</html>
